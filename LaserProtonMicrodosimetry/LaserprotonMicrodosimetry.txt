# GAP Cirrone, May 2022
# A tempestive to migrate microdosimetric concepts to a laser-driven and intense beam
#


# =====================   MATERIALS  =======================================
#
#sv:Ma/Vacuum/Components = 4 "Carbon" "Nitrogen" "Oxygen" "Argon"
#uv:Ma/Vacuum/Fractions = 4 0.000124 0.755268 0.231781 0.012827
#d:Ma/Vacuum/Density = 1.0E-25 g/cm3
#s:Ma/Vacuum/State = "Gas"
#d:Ma/Vacuum/Temperature = 2.73 kelvin
#d:Ma/Vacuum/Pressure = 3.0E-18 pascal
#s:Ma/Vacuum/DefaultColor = "skyblue"

#
# Silicon Carbide
#
sv:Ma/SiliconCarbide/Components 	= 2 "Silicon" "Carbon"
uv:Ma/SiliconCarbide/Fractions  	= 2 0.5 0.5
d:Ma/SiliconCarbide/Density 		= 3.21 g/cm3
s:Ma/SiliconCarbide/DefaultColor 	= "red"

# Nickel Silicide
#
sv:Ma/NickelSilicide/Components 	= 2 "Nickel" "Silicon"
uv:Ma/NickelSilicide/Fractions  	= 2 0.80693 0.19306
d:Ma/NickelSilicide/Density 		= 7.40 g/cm3
s:Ma/NickelSilicide/DefaultColor 	= "Maroon"

# =======================   VOLUMES  =======================================
#
#
# Definition of the World volume
# ------------------------------
#
d:Ge/World/HLX       = 80 cm
d:Ge/World/HLY       = 80 cm
d:Ge/World/HLZ       = 80 cm
s:Ge/World/Material= "Vacuum"


b:Ge/World/Invisible = "False"


# Water degraders that put the detector 
# in to the correct irradiation position 
# ---------------------------------
#


# A detection plane
# ---------------------------------
#
s:Ge/SiCDetector/Type     = "TsBox"
s:Ge/SiCDetector/Parent   = "World"
#s:Ge/SiCDetector/Material = "G4_WATER"
s:Ge/SiCDetector/Material = "SiliconCarbide"
d:Ge/SiCDetector/HLX      = 245 mm
d:Ge/SiCDetector/HLY      = 245 mm
d:Ge/SiCDetector/HLZ      = 5.0 um
d:Ge/SiCDetector/TransX   = 0. cm
d:Ge/SiCDetector/TransY   = 0. cm
d:Ge/SiCDetector/TransZ   = 5.3 um 
d:Ge/SiCDetector/RotX     = 0. deg
d:Ge/SiCDetector/RotY     = 0. deg
d:Ge/SiCDetector/RotZ     = 0. deg
s:Ge/SiCDetector/Color    = "red"
s:Ge/SiCDetector/DrawingStyle = "Wireframe" # "Solid", "Wireframe" or "FullWireFrame"


# =====================   SCORING  =======================================
#
# Calculation of the spectra of total energy deposit and other quantities 
# inside the SiC detector
# Generated file in an .xml file that must be read with a dedicated python
# script Pablo wrote
#
s:Sc/EnergyDepositedSpectra/Quantity                    = "EnergyDeposit"
s:Sc/EnergyDepositedSpectra/Component                   = "SiCDetector"
b:Sc/EnergyDepositedSpectra/OutputToConsole             = "TRUE"
s:Sc/EnergyDepositedSpectra/IfOutputFileAlreadyExists   = "Overwrite"
i:Sc/EnergyDepositedSpectra/HistogramBins               = 10000
d:Sc/EnergyDepositedSpectra/HistogramMin                = 0 keV
d:Sc/EnergyDepositedSpectra/HistogramMax                = 300 keV
s:Sc/EnergyDepositedSpectra/OutputType                  = "Xml"
#sv:Sc/EnergyDepositedSpectra/OnlyIncludeParticlesCharged = 1 "Positive"
s:Sc/XmlFileName		   		      	= "EnergyDepositedSpectra"



# Z binning causes creation of a parallel world for scoring
# e questo permette di fare il picco di Bragg
#
#s:Sc/depthDoseDistributionDegrader/Quantity                  = "EnergyDeposit"
#s:Sc/depthDoseDistributionDegrader/Component                 = "WaterDegrader"
#b:Sc/depthDoseDistributionDegrader/OutputToConsole           = "TRUE"
#s:Sc/depthDoseDistributionDegrader/IfOutputFileAlreadyExists = "Overwrite"
#i:Sc/depthDoseDistributionDegrader/ZBins                     = 320
#s:Sc/depthDoseDistributionDegrader/OutputFile                = "DepthDose_degrader_SiC_5_0"



# The following fill an histogram with the Fluence: the total track length
# divided by the Volume

s:Sc/FluenceSpectra/Quantity                    = "Fluence"
s:Sc/FluenceSpectra/Component                   = "SiCDetector"
b:Sc/FluenceSpectra/OutputToConsole             = "FALSE"
s:Sc/FluenceSpectra/IfOutputFileAlreadyExists   = "Overwrite"
i:Sc/FluenceSpectra/HistogramBins               = 10000 
d:Sc/FluenceSpectra/HistogramMin                = 0.03 /mm2
d:Sc/FluenceSpectra/HistogramMax                = 0.06 /mm2
s:Sc/FluenceSpectra/OutputType                  = "Xml"


# Use of an external extension to generate ntuple with the relevant information
# In this case we will register the total energy deposited in a volume (the detector)
# In the meantime other information will be registered:
# 1: The energy deposited; 2: the weight; 3: the particle type (PDF format); 
# 4: if is the first scored particle from this history
#	
s:Sc/Scorer_Pablo/Quantity			= "PabloNtupleScorerOnVolume"
s:Sc/Scorer_Pablo/Component   			= "SiCDetector"
s:Sc/Scorer_Pablo/OutputType          		= "ASCII"
b:Sc/Scorer_Pablo/OutputToConsole            	= "FALSE"       
s:Sc/Scorer_Pablo/IfOutputFileAlreadyExists 	= "Overwrite" 


s:Sc/InfoFirstStage/Quantity                    = "PhaseSpace"
b:Sc/InfoFirstStage/OutputToConsole             = "True"
s:Sc/InfoFirstStage/Surface                     = "SiCDetector/ZMinusSurface"
s:Sc/InfoFirstStage/OutputType         	 	= "ASCII" 
s:Sc/InfoFirstStage/OutputFile                  = "ASCIIOutput"
s:Sc/InfoFirstStage/OnlyIncludeParticlesGoing  	= "In"
b:Sc/InfoFirstStage/IncludeRunID                = "True"
b:Sc/InfoFirstStage/IncludeEventID              = "True"
b:Sc/InfoFirstStage/IncludeTrackID              = "True"
b:Sc/InfoFirstStage/IncludeParentID             = "True"
b:Sc/InfoFirstStage/IncludeCreatorProcess       = "True"
b:Sc/InfoFirstStage/IncludeVertexInfo           = "True"



# Scores in the Delta_E detector: calcola l'energia totale depositata in tutto il run
#
#s:Sc/DoseAtDeltaE_Detector/Quantity          	      = "EnergyDeposit"
#s:Sc/DoseAtDeltaE_Detector/Component                 = "DeltaE_Detector"
#b:Sc/DoseAtDeltaE_Detector/OutputToConsole           = "TRUE"
#s:Sc/DoseAtDeltaE_Detector/IfOutputFileAlreadyExists = "Overwrite"


# Con le seguenti linee calcolo il LET in ogni fetta del rivelatore che 
# ho chiamato DeltaE_Detector
#
#s:Sc/LETAtPhantom0/Quantity                  = "ProtonLET"
#s:Sc/LETAtPhantom0/Component                 = "DeltaE_Detector"
#s:Sc/LETAtPhantom0/WeightBy                  = "Dose"
# d:Sc/LETAtPhantom0/MaxScoredLET             = 40 MeV/mm/(g/cm3)
#vs:Sc/LETAtPhantom0/OutputFile                = "LET"
#b:Sc/LETAtPhantom0/OutputToConsole           = "TRUE"
#s:Sc/LETAtPhantom0/IfOutputFileAlreadyExists = "Overwrite"
#sv:Sc/LETAtPhantom0/Report                   = 1 "Sum"

#b:Ts/UseQt = "True"
# =====================   VISUALISATION  =======================================
#
s:Gr/ViewA/Type                             = "OpenGL"
i:Gr/ViewA/WindowSizeX                      = 900
i:Gr/ViewA/WindowSizeY                      = 900
#d:Gr/ViewA/Theta                            = 55 deg
#d:Gr/ViewA/Phi                              = 20 deg
#s:Gr/ViewA/Projection                       = "Perspective"
#d:Gr/ViewA/PerspectiveAngle                 = 30 deg
u:Gr/ViewA/Zoom                             = 1.3
b:Gr/ViewA/HiddenLineRemovalForTrajectories = "True"
sv:Gr/ViewA/VisibleWorlds                   = 1 "All"
#b:Gr/ViewA/IncludeAxes      		    = "True"
#d:Gr/ViewA/AxesSize                         = 0.1 mm


sv:Ph/Default/Modules = 6 "g4em-standard_opt4" "g4h-phy_QGSP_BIC_HP" "g4decay" "g4ion-binarycascade" "g4h-elastic_HP" "g4stopping"



# =====================   BEAM  =======================================

#proton source
#
s:So/proton_9.4/Type="Beam"
s:So/proton_9.4/Component="BeamPosition"
d:Ge/BeamPosition/TransZ = -10. cm
d:Ge/BeamPosition/RotX = 0. deg
s:So/proton_9.4/BeamParticle="proton"
d:So/proton_9.4/BeamEnergy = 9.4 MeV
u:So/proton_9.4/BeamEnergySpread = 0.01
s:So/proton_9.4/BeamPositionDistribution="Gaussian"
s:So/proton_9.4/BeamPositionCutoffShape ="Ellipse"
d:So/proton_9.4/BeamPositionCutoffX =0.1 mm
d:So/proton_9.4/BeamPositionCutoffY =0.1 mm
d:So/proton_9.4/BeamPositionSpreadX=0.03 mm
d:So/proton_9.4/BeamPositionSpreadY=0.03 mm

s:So/proton_9.4/BeamAngularDistribution="None"
d:So/proton_9.4/BeamAngularCutoffX= 0.1 deg
d:So/proton_9.4/BeamAngularCutoffY= 0.1 deg

d:So/proton_9.4/BeamAngularSpreadX= 0.01 rad
d:So/proton_9.4/BeamAngularSpreadY= 0.01 rad
d:Ge/BeamPosition/TransX = 0. cm
d:Ge/BeamPosition/TransY = 0. cm




# =====================   OTHER SETTING  =======================================

# Tracking verbosity
#
i:Ts/TrackingVerbosity = 0


d:Ph/Default/CutForAllParticles = 0.01 mm 

i:Ts/Seed = 285

b:Ge/QuitIfOverlapDetected = "True"

#b:Ts/PauseBeforeSequence = "True"

# =====================   NUMBER OF EVENTS  =======================================
#
i:So/proton_9.4/NumberOfHistoriesInRun   = 100

i:Ts/NumberOfThreads = 12
#i:Ts/ShowHistoryCountAtInterval = 100


b:Ts/PauseBeforeQuit = "True"

